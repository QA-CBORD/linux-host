<st-header title="Request funds" [isTitleShow]="true" [backButtonTitle]="'Back'" [isToolbarShow]="true"></st-header>
<ion-content padding class="request-funds">
    <ng-container *ngIf="(accounts$ | async).length; else empty">
        <p class="request-funds__info-msg">Email a friend or family member to request a deposit to your account.</p>

        <form class="request-funds__form" [formGroup]="requestFundsForm" novalidate (ngSubmit)="onSubmit()">

            <st-input-floating-label
                    [isError]="name.invalid && name.touched"
                    [control]="name"
                    [formControlName]="controlsNames.name"
                    title="Enter name"
                    class="request-funds__control"
                    type="text"
                    idd="name"
                    label="Name"
            >
                <p class="request-funds__control-error-msg">
                    {{ name.errors?.errorMsg }}
                </p>
            </st-input-floating-label>

            <st-input-floating-label
                    [isError]="email.invalid && email.touched"
                    [control]="email"
                    [formControlName]="controlsNames.email"
                    title="Enter email"
                    class="request-funds__control"
                    type="email"
                    idd="email"
                    label="Email Address"
            >
                <p class="request-funds__control-error-msg">
                    {{ email.errors?.errorMsg }}
                </p>
            </st-input-floating-label>

            <st-select-floating-label
                    [formControlName]="controlsNames.account"
                    [control]="accounts"
                    [interfaceOptions]="customActionSheetOptions"
                    [isError]="accounts.invalid && accounts.touched"
                    class="request-funds__control"
                    interface="action-sheet"
                    title="Choose an account from a dropdown list below"
                    label="Select Your Account"
                    idd="accounts"
            >
                <ng-container role="options">
                    <ion-select-option *ngFor="let account of (accounts$ | async); trackBy: accountTrack"
                                       [value]="account.id">
                        {{ account.accountDisplayName }} ({{ account.balance | transactionUnits: account.accountType }})
                    </ion-select-option>
                </ng-container>

                <ng-container role="error">
                    <p class="request-funds__control-error-msg">
                        {{ accounts.errors?.errorMsg }}
                    </p>
                </ng-container>
            </st-select-floating-label>

            <st-textarea-floating-label
                    [control]="message"
                    [isError]="message.invalid && message.touched"
                    [formControlName]="controlsNames.message"
                    class="request-funds__control"
                    idd="message"
                    label="Message"
                    title="Type your message here..."
                    rows="3"
            >
                <p class="request-funds__control-error-msg">
                    {{ message.errors?.errorMsg }}
                </p>
            </st-textarea-floating-label>

            <ion-button
                    type="submit"
                    class="request-funds__button"
                    [ngClass]="{ 'request-funds__button--disabled': requestFundsForm.invalid }"
            >send request
            </ion-button>

        </form>
    </ng-container>
</ion-content>

<ng-template #empty>
    <img class="request-funds__empty-image" src="/assets/images/transfer_illustration.svg" alt="money transfer image"/>
    <p class="request-funds__empty-message">No compatible accounts. You can only request funds for deposit accounts.</p>
    <ion-button class="request-funds__button request-funds__button--blue" (click)="back()">back to accounts</ion-button>
</ng-template>
