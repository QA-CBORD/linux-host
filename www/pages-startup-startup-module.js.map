{"version":3,"sources":["webpack:///./src/app/non-authorized/pages/startup/startup.module.ts","webpack:///./src/app/non-authorized/pages/startup/startup.page.html","webpack:///./src/app/non-authorized/pages/startup/startup.page.scss","webpack:///./src/app/non-authorized/pages/startup/startup.page.ts"],"names":[],"mappings":"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","file":"pages-startup-startup-module.js","sourcesContent":["import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule } from '@angular/forms';\r\nimport { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { IonicModule } from '@ionic/angular';\r\n\r\nimport { StartupPage } from './startup.page';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: '',\r\n    component: StartupPage\r\n  }\r\n];\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    IonicModule,\r\n    RouterModule.forChild(routes)\r\n  ],\r\n  declarations: [StartupPage]\r\n})\r\nexport class StartupPageModule {}\r\n","module.exports = \"<ion-content class=\\\"startup__background\\\">\\r\\n  <img class=\\\"startup__image\\\" src=\\\"/assets/images/splash_icon_get.svg\\\" alt=\\\"GET CBORD Student Icon\\\" />\\r\\n</ion-content>\\r\\n\"","module.exports = \".startup__image {\\n  margin: 0;\\n  position: absolute;\\n  top: 50%;\\n  left: 50%;\\n  -webkit-transform: translate(-50%, -50%);\\n          transform: translate(-50%, -50%);\\n  width: 128px;\\n  height: 128px; }\\n\\n.startup__background {\\n  --ion-background-color: radial-gradient(121.92% 121.92% at 50% 50%, #166dff 0%, #003080 100%), #003080; }\\n\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9hcHAvbm9uLWF1dGhvcml6ZWQvcGFnZXMvc3RhcnR1cC9DOlxcVXNlcnNcXGJzcFxcRG9jdW1lbnRzXFxHaXRSZXBvc1xcY2JvcmQtc3R1ZGVudC9zcmNcXGFwcFxcbm9uLWF1dGhvcml6ZWRcXHBhZ2VzXFxzdGFydHVwXFxzdGFydHVwLnBhZ2Uuc2NzcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDRTtFQUNFLFNBQVM7RUFDVCxrQkFBa0I7RUFDbEIsUUFBUTtFQUNSLFNBQVM7RUFDVCx3Q0FBZ0M7VUFBaEMsZ0NBQWdDO0VBQ2hDLFlBQVk7RUFDWixhQUFhLEVBQUE7O0FBR2Y7RUFDRSxzR0FBdUIsRUFBQSIsImZpbGUiOiJzcmMvYXBwL25vbi1hdXRob3JpemVkL3BhZ2VzL3N0YXJ0dXAvc3RhcnR1cC5wYWdlLnNjc3MiLCJzb3VyY2VzQ29udGVudCI6WyIuc3RhcnR1cCB7XHJcbiAgJl9faW1hZ2Uge1xyXG4gICAgbWFyZ2luOiAwO1xyXG4gICAgcG9zaXRpb246IGFic29sdXRlO1xyXG4gICAgdG9wOiA1MCU7XHJcbiAgICBsZWZ0OiA1MCU7XHJcbiAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZSgtNTAlLCAtNTAlKTtcclxuICAgIHdpZHRoOiAxMjhweDtcclxuICAgIGhlaWdodDogMTI4cHg7XHJcbiAgfVxyXG5cclxuICAmX19iYWNrZ3JvdW5kIHtcclxuICAgIC0taW9uLWJhY2tncm91bmQtY29sb3I6IHJhZGlhbC1ncmFkaWVudCgxMjEuOTIlIDEyMS45MiUgYXQgNTAlIDUwJSwgIzE2NmRmZiAwJSwgIzAwMzA4MCAxMDAlKSwgIzAwMzA4MDtcclxuICB9XHJcbn1cclxuIl19 */\"","import { Component, OnInit } from '@angular/core';\r\nimport { IdentityFacadeService, LoginState } from '@core/facades/identity/identity.facade.service';\r\nimport { ROLES } from '../../../app.global';\r\nimport { GUEST_ROUTES } from '../../non-authorized.config';\r\nimport { PATRON_ROUTES } from '@sections/section.config';\r\nimport { Router } from '@angular/router';\r\nimport { switchMap, take, tap } from 'rxjs/operators';\r\nimport { AuthFacadeService } from '@core/facades/auth/auth.facade.service';\r\nimport { from } from 'rxjs';\r\n\r\n@Component({\r\n  selector: 'st-startup',\r\n  templateUrl: './startup.page.html',\r\n  styleUrls: ['./startup.page.scss'],\r\n})\r\nexport class StartupPage implements OnInit {\r\n  constructor(\r\n    private readonly router: Router,\r\n    private readonly identityFacadeService: IdentityFacadeService,\r\n    private readonly authFacadeService: AuthFacadeService\r\n  ) {}\r\n\r\n  ngOnInit() {}\r\n\r\n  ionViewWillEnter() {\r\n    console.log('Startup Page - ViewWillEnter');\r\n    this.doLoginChecks();\r\n  }\r\n\r\n  private doLoginChecks() {\r\n    const routeConfig = { replaceUrl: true };\r\n    this.authFacadeService\r\n      .getAuthSessionToken$()\r\n      .pipe(\r\n        switchMap(sessionId =>\r\n          from(this.identityFacadeService.determineFromBackgroundLoginState(sessionId))\r\n        ),\r\n        take(1)\r\n      )\r\n      .subscribe(state => {\r\n        console.log('StartupPage - login state:', state);\r\n        switch (state) {\r\n          case LoginState.SELECT_INSTITUTION:\r\n            this.identityFacadeService.logoutUser();\r\n            this.router.navigate([ROLES.guest, GUEST_ROUTES.entry], routeConfig);\r\n            break;\r\n          case LoginState.BIOMETRIC_LOGIN:\r\n            this.loginUser(true);\r\n            break;\r\n          case LoginState.BIOMETRIC_SET:\r\n            this.router.navigate([ROLES.patron, PATRON_ROUTES.dashboard], routeConfig);\r\n            break;\r\n          case LoginState.PIN_LOGIN:\r\n            this.loginUser(false);\r\n            break;\r\n          case LoginState.PIN_SET:\r\n            this.identityFacadeService.pinOnlyLoginSetup();\r\n            break;\r\n          case LoginState.HOSTED:\r\n            this.router.navigate([ROLES.guest, GUEST_ROUTES.login], routeConfig);\r\n            break;\r\n          case LoginState.EXTERNAL:\r\n            this.router.navigate([ROLES.guest, GUEST_ROUTES.external], routeConfig);\r\n            break;\r\n          case LoginState.DONE:\r\n            this.router.navigate([ROLES.patron, PATRON_ROUTES.dashboard], routeConfig);\r\n            break;\r\n        }\r\n      });\r\n  }\r\n\r\n  private loginUser(useBiometric: boolean) {\r\n    try {\r\n      this.identityFacadeService.loginUser(useBiometric);\r\n    } catch (e) {\r\n      console.log('loginUser error: ', e);\r\n    }\r\n  }\r\n}\r\n"],"sourceRoot":""}