{"version":3,"sources":["webpack:///./src/app/core/service/coords/coords.service.ts","webpack:///./src/app/sections/mobile-access/mobile-access-routing.module.ts","webpack:///./src/app/sections/mobile-access/mobile-access.module.ts","webpack:///./src/app/sections/mobile-access/resolvers/index.ts","webpack:///./src/app/sections/mobile-access/resolvers/locations.resolver.guard.ts","webpack:///./src/app/shared/pipes/meters-to-miles-pipe/meters-to-miles-pipe.module.ts","webpack:///./src/app/shared/ui-components/st-countdown/st-countdown.module.ts"],"names":[],"mappings":"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","file":"mobile-access-mobile-access-module.js","sourcesContent":["import { Injectable } from '@angular/core';\r\n\r\nimport { BehaviorSubject, from, Observable, of } from 'rxjs';\r\nimport { catchError, skipWhile, take } from 'rxjs/operators';\r\n\r\nimport { GeolocationPosition, Plugins } from '@capacitor/core';\r\n\r\nconst { Geolocation } = Plugins;\r\n\r\n@Injectable({\r\n  providedIn: 'root',\r\n})\r\nexport class CoordsService {\r\n  private readonly fetchInterval: number = 5000;\r\n  private timestamp: number = 0;\r\n\r\n  private latestPosition: GeolocationPosition = {\r\n    timestamp: null,\r\n    coords: {\r\n      accuracy: null,\r\n      latitude: null,\r\n      longitude: null,\r\n    },\r\n  };\r\n  private readonly _location$: BehaviorSubject<GeolocationPosition> = new BehaviorSubject<GeolocationPosition>(\r\n    undefined\r\n  );\r\n  private readonly emptyPosition: GeolocationPosition = {\r\n    timestamp: null,\r\n    coords: {\r\n      accuracy: null,\r\n      latitude: null,\r\n      longitude: null,\r\n    },\r\n  };\r\n\r\n  constructor() {}\r\n\r\n  get location$(): Observable<GeolocationPosition> {\r\n    return this._location$.asObservable().pipe(skipWhile(value => !value));\r\n  }\r\n\r\n  set _latestLocation(position: GeolocationPosition) {\r\n    this.latestPosition = { ...position };\r\n    this._location$.next(this.latestPosition);\r\n  }\r\n\r\n  getCoords(): Observable<GeolocationPosition> {\r\n    const timeDiff = new Date().getTime() - this.timestamp;\r\n    if (timeDiff > this.fetchInterval) {\r\n      this.requestLocationFromDevice();\r\n    }\r\n    return this.location$;\r\n  }\r\n\r\n  private requestLocationFromDevice() {\r\n    const options = {\r\n      enableHighAccuracy: true,\r\n      timeout: 5,\r\n    };\r\n\r\n    from(Geolocation.getCurrentPosition(options))\r\n      .pipe(\r\n        take(1),\r\n        catchError(error => of(this.emptyPosition))\r\n      )\r\n      .subscribe(\r\n        resp => {\r\n          /// set timestamp and set location\r\n          this.timestamp = new Date().getTime();\r\n          this._latestLocation = resp;\r\n        },\r\n        error => {\r\n          /// clear timestamp and return empty position so we can try another request\r\n          this.timestamp = 0;\r\n          this._latestLocation = this.emptyPosition;\r\n        }\r\n      );\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { RouterModule, Routes } from '@angular/router';\r\n\r\nimport { MobileAccessPage } from './mobile-access.page';\r\nimport { LocationsResolverGuard } from './resolvers';\r\nimport { ActivateLocationComponent } from './activate-location';\r\nimport { LOCAL_ROUTING } from './mobile-acces.config';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: '',\r\n    resolve: { coords: LocationsResolverGuard },\r\n    children: [\r\n      {\r\n        path: '',\r\n        pathMatch: 'full',\r\n        component: MobileAccessPage,\r\n        data: { preload: true },\r\n      },\r\n      {\r\n        path: `${LOCAL_ROUTING.activate}/:id`,\r\n        component: ActivateLocationComponent,\r\n        data: { preload: true },\r\n      },\r\n    ],\r\n  },\r\n\r\n];\r\n\r\nconst imports = [RouterModule.forChild(routes)];\r\nconst exports = [RouterModule];\r\n\r\n@NgModule({ imports, exports })\r\nexport class MobileAccessRoutingModule {\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule } from '@angular/forms';\r\nimport { IonicModule } from '@ionic/angular';\r\n\r\nimport { MobileAccessPage } from './mobile-access.page';\r\nimport { MobileAccessRoutingModule } from './mobile-access-routing.module';\r\nimport { LocationListComponent } from './location-list';\r\nimport { LocationItemComponent } from './location-list/location-item';\r\nimport { MobileAccessService } from './service';\r\nimport { ActivateLocationComponent } from './activate-location';\r\nimport { MobileAccessPopoverComponent } from './mobile-access-popover';\r\nimport { StActivateLocationItemModule } from '@shared/ui-components/st-activate-location-item/st-activate-location-item.module';\r\nimport { LocationsResolverGuard } from './resolvers/locations.resolver.guard';\r\nimport { StopPropagationModule } from '@shared/directives/stop-propogation/stop-propagation.module';\r\nimport { MetersToMilesPipeModule } from '@shared/pipes/meters-to-miles-pipe/meters-to-miles-pipe.module';\r\nimport { TruncatePipeModule } from '@shared/pipes/truncate-pipe/truncate-pipe.module';\r\nimport { StCountdownModule } from '@shared/ui-components/st-countdown/st-countdown.module';\r\nimport { StPopoverLayoutModule } from '@shared/ui-components/st-popover-layout/st-popover-layout.module';\r\nimport { StHeaderModule } from '@shared/ui-components/st-header/st-header.module';\r\nimport { StSpinnerModule } from '@shared/ui-components/st-spinner/st-spinner.module';\r\nimport { StButtonModule } from '@shared/ui-components/st-button';\r\n\r\nconst imports = [\r\n  CommonModule,\r\n  FormsModule,\r\n  IonicModule,\r\n  MobileAccessRoutingModule,\r\n  StopPropagationModule,\r\n  MetersToMilesPipeModule,\r\n  TruncatePipeModule,\r\n  StCountdownModule,\r\n  StPopoverLayoutModule,\r\n  StHeaderModule,\r\n  StSpinnerModule,\r\n  StActivateLocationItemModule,\r\n  StButtonModule\r\n];\r\n\r\nconst declarations = [\r\n  MobileAccessPage,\r\n  LocationListComponent,\r\n  ActivateLocationComponent,\r\n  LocationItemComponent,\r\n  MobileAccessPopoverComponent,\r\n];\r\nconst providers = [LocationsResolverGuard, MobileAccessService];\r\nconst entryComponents = [MobileAccessPopoverComponent];\r\n\r\n@NgModule({\r\n  imports,\r\n  declarations,\r\n  providers,\r\n  entryComponents,\r\n})\r\nexport class MobileAccessPageModule {}\r\n","export * from './locations.resolver.guard';\r\n","import { Injectable } from '@angular/core';\r\nimport { Router } from '@angular/router';\r\nimport { Resolve } from '@angular/router/src/interfaces';\r\n\r\nimport { catchError, tap, retryWhen, take } from 'rxjs/operators';\r\nimport { Observable, of, throwError } from 'rxjs';\r\n\r\nimport { MobileAccessService } from '../service';\r\nimport { MMobileLocationInfo } from '../model';\r\nimport { LoadingService } from '../../../core/service/loading/loading.service';\r\nimport { LOCAL_ROUTING } from '../mobile-acces.config';\r\n\r\n@Injectable()\r\nexport class LocationsResolverGuard implements Resolve<Observable<MMobileLocationInfo[] | boolean>> {\r\n  constructor(\r\n    private readonly mobileAccessService: MobileAccessService,\r\n    private readonly router: Router,\r\n    private readonly loader: LoadingService\r\n  ) {}\r\n\r\n  resolve(): Observable<MMobileLocationInfo[] | boolean> {\r\n    const snapshot = this.router.routerState.snapshot;\r\n    if (!snapshot.url.includes(LOCAL_ROUTING.activate)) {\r\n      return this.downloadData();\r\n    }\r\n    return of(true);\r\n  }\r\n\r\n  private downloadData(): Observable<MMobileLocationInfo[]> {\r\n    this.loader.showSpinner();\r\n    this.mobileAccessService\r\n      .initContentStringsList()\r\n      .pipe(take(1))\r\n      .subscribe();\r\n\r\n    return this.mobileAccessService.getLocations().pipe(\r\n      take(1),\r\n      retryWhen(errors =>\r\n        errors.pipe(\r\n          //log error message\r\n\r\n          tap(() => {\r\n            this.loader.closeSpinner();\r\n            console.log('An error occurred while trying to retrieve your information.');\r\n          }),\r\n          take(1)\r\n        )\r\n      ),\r\n      catchError(e => {\r\n        // TODO: paste here logic with retry button\r\n        this.loader.closeSpinner();\r\n        return throwError(e);\r\n      }),\r\n      tap(() => this.loader.closeSpinner())\r\n    );\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport { MetersToMilesPipe } from './meters-to-miles.pipe';\r\n\r\nconst declarations = [MetersToMilesPipe];\r\n\r\n@NgModule({\r\n  declarations,\r\n  imports: [\r\n    CommonModule\r\n  ],\r\n  exports: declarations\r\n})\r\nexport class MetersToMilesPipeModule { }\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { StCountdownComponent } from './st-countdown.component';\r\n\r\nconst declarations = [StCountdownComponent];\r\n\r\n@NgModule({\r\n  declarations,\r\n  imports: [\r\n    CommonModule\r\n  ],\r\n  exports: declarations\r\n})\r\nexport class StCountdownModule { }\r\n"],"sourceRoot":""}