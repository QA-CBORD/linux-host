/*! Ionic Enterprise Identity Vault: https://ionicframework.com/ - Commercially Licensed */
var ionicEnterpriseIdentityVaultExports=function(r){"use strict";var t,e;(t=r.VaultErrorCodes||(r.VaultErrorCodes={}))[t.Unknown=0]="Unknown",t[t.VaultLocked=1]="VaultLocked",t[t.VaultUnavailable=2]="VaultUnavailable",t[t.InvalidArguments=3]="InvalidArguments",t[t.InvalidatedCredential=4]="InvalidatedCredential",t[t.SecurityNotAvailable=5]="SecurityNotAvailable",t[t.AuthFailed=6]="AuthFailed",t[t.TooManyFailedAttempts=7]="TooManyFailedAttempts",t[t.UserCanceledInteraction=8]="UserCanceledInteraction",t[t.MismatchedPasscode=9]="MismatchedPasscode",t[t.MissingPasscode=10]="MissingPasscode",t[t.PasscodeNotEnabled=11]="PasscodeNotEnabled",t[t.KeyNotFound=12]="KeyNotFound",t[t.BiometricsNotEnabled=13]="BiometricsNotEnabled",t[t.InvalidAuthMode=14]="InvalidAuthMode",(e=r.AuthMode||(r.AuthMode={}))[e.BiometricOnly=0]="BiometricOnly",e[e.PasscodeOnly=1]="PasscodeOnly",e[e.BiometricAndPasscode=2]="BiometricAndPasscode",e[e.InMemoryOnly=3]="InMemoryOnly",e[e.BiometricOrPasscode=4]="BiometricOrPasscode",e[e.SecureStorage=5]="SecureStorage";
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
var h=function(){return(h=Object.assign||function(t){for(var e,n=1,s=arguments.length;n<s;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};function o(o,i,a,u){return new(a=a||Promise)(function(t,e){function n(t){try{r(u.next(t))}catch(t){e(t)}}function s(t){try{r(u.throw(t))}catch(t){e(t)}}function r(e){e.done?t(e.value):new a(function(t){t(e.value)}).then(n,s)}r((u=u.apply(o,i||[])).next())})}function f(n,s){var r,o,i,t,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return t={next:e(0),throw:e(1),return:e(2)},"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,o&&(i=2&e[0]?o.return:e[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,e[1])).done)return i;switch(o=0,i&&(e=[2&e[0],i.value]),e[0]){case 0:case 1:i=e;break;case 4:return a.label++,{value:e[1],done:!1};case 5:a.label++,o=e[1],e=[0];continue;case 7:e=a.ops.pop(),a.trys.pop();continue;default:if(!(i=0<(i=a.trys).length&&i[i.length-1])&&(6===e[0]||2===e[0])){a=0;continue}if(3===e[0]&&(!i||e[1]>i[0]&&e[1]<i[3])){a.label=e[1];break}if(6===e[0]&&a.label<i[1]){a.label=i[1],i=e;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(e);break}i[2]&&a.ops.pop(),a.trys.pop();continue}e=s.call(n,a)}catch(t){e=[6,t],o=0}finally{r=i=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}}var n=(Object.defineProperty(s.prototype,"token",{get:function(){var t=this.session;return t&&t.token},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"username",{get:function(){var t=this.session;return t&&t.username},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"config",{get:function(){if(this._config){var t,e=this._config.isBiometricsEnabled,n=this._config.isPasscodeEnabled;return this._config.isSecureStorageModeEnabled?t=r.AuthMode.SecureStorage:e&&n?t=r.AuthMode.BiometricAndPasscode:e&&!n?t=r.AuthMode.BiometricOnly:!e&&n?t=r.AuthMode.PasscodeOnly:e||n||(t=r.AuthMode.InMemoryOnly),{authMode:t,isPasscodeSetupNeeded:this._config.isPasscodeSetupNeeded,lockAfter:this._config.lockAfter,hideScreenOnBackground:this._config.hideScreenOnBackground}}},enumerable:!0,configurable:!0}),s.prototype.onVaultLocked=function(t){},s.prototype.onSessionRestoreError=function(t){},s.prototype.onUnlockOnReadyError=function(t){},s.prototype.onVaultUnlocked=function(t){},s.prototype.onVaultReady=function(t){},s.prototype.onSetupError=function(t){},s.prototype.onConfigChange=function(t){},s.prototype.onSessionRestored=function(t){},s.prototype.onPasscodeRequest=function(t){return o(this,void 0,void 0,function(){return f(this,function(t){return[2]})})},s.prototype.onReady=function(a){return o(this,void 0,void 0,function(){var e,n,s,r,o,i;return f(this,function(t){switch(t.label){case 0:return this._readyCalled?[2]:(this._readyCalled=!0,this.vault=a,[4,this.vault.isInUse()]);case 1:return e=t.sent(),this._config=a.config,[4,this.vault.isLocked()];case 2:n=t.sent(),t.label=3;case 3:return t.trys.push([3,6,,7]),this.options.restoreSessionOnReady&&e?[4,this._restoreSession()]:[3,5];case 4:t.sent(),t.label=5;case 5:return[3,7];case 6:return r=t.sent(),s=r,[3,7];case 7:return t.trys.push([7,10,,11]),n&&this.options.unlockOnReady?[4,this._unlock()]:[3,9];case 8:t.sent(),t.label=9;case 9:return[3,11];case 10:return i=t.sent(),o=i,[3,11];case 11:return t.trys.push([11,14,,15]),e?[3,13]:[4,this._trySetAuthMode(this.options.authMode)];case 12:t.sent(),t.label=13;case 13:return[3,15];case 14:return t.sent(),[3,15];case 15:return this._readyResolve(),this.onVaultReady(this.config),s&&this.onSessionRestoreError(s),o&&this.onUnlockOnReadyError(s),[2]}})})},s.prototype.onLock=function(t){this.session=void 0,this.onVaultLocked(t)},s.prototype.onUnlock=function(e){return o(this,void 0,void 0,function(){return f(this,function(t){switch(t.label){case 0:return[4,this.ready()];case 1:return t.sent(),this._config=e,this.onVaultUnlocked(this.config),[2]}})})},s.prototype.onError=function(t){this._readyReject(t),this.onSetupError(t)},s.prototype.onConfig=function(t){this._config=t,this.onConfigChange(this.config)},s.prototype.ready=function(){return o(this,void 0,void 0,function(){return f(this,function(t){return[2,this._readyPromise]})})},s.prototype._unlock=function(s){return o(this,void 0,void 0,function(){var e,n;return f(this,function(t){switch(t.label){case 0:return[4,this.vault.isLocked()];case 1:if(!t.sent())return[2];switch(s=void 0!==s&&s!==r.AuthMode.BiometricOrPasscode?s:this.config.authMode){case r.AuthMode.BiometricOnly:return[3,2];case r.AuthMode.PasscodeOnly:return[3,3];case r.AuthMode.BiometricAndPasscode:return[3,4]}return[3,12];case 2:return[2,this.vault.unlock()];case 3:return[2,this.unlockWithPasscode()];case 4:return t.trys.push([4,6,,12]),[4,this.vault.unlock()];case 5:return t.sent(),[2];case 6:return e=t.sent(),-1<[r.VaultErrorCodes.AuthFailed,r.VaultErrorCodes.BiometricsNotEnabled,r.VaultErrorCodes.UserCanceledInteraction,r.VaultErrorCodes.InvalidatedCredential].indexOf(e.code)?[4,this.unlockWithPasscode()]:[3,11];case 7:return t.sent(),e.code!==r.VaultErrorCodes.InvalidatedCredential?[3,10]:[4,this.restoreSession()];case 8:return n=t.sent(),[4,this.saveSession(n)];case 9:t.sent(),t.label=10;case 10:return[2];case 11:throw e;case 12:return[2]}})})},s.prototype.unlock=function(e){return o(this,void 0,void 0,function(){return f(this,function(t){switch(t.label){case 0:return[4,this.ready()];case 1:return t.sent(),[2,this._unlock(e)]}})})},s.prototype.unlockWithPasscode=function(){return o(this,void 0,void 0,function(){var e;return f(this,function(t){switch(t.label){case 0:return[4,this.onPasscodeRequest(!1)];case 1:return e=t.sent(),[2,this.vault.unlock(!0,e)]}})})},s.prototype._setPasscode=function(){return o(this,void 0,void 0,function(){var e;return f(this,function(t){switch(t.label){case 0:return[4,this.vault.isLocked()];case 1:if(t.sent())throw{code:r.VaultErrorCodes.VaultLocked,message:"Operation not allowed while vault locked."};return[4,this.onPasscodeRequest(!0)];case 2:return e=t.sent(),[2,this.vault.setPasscode(e)]}})})},s.prototype.setPasscode=function(){return o(this,void 0,void 0,function(){return f(this,function(t){switch(t.label){case 0:return[4,this.ready()];case 1:return t.sent(),[2,this._setPasscode()]}})})},s.prototype.getSession=function(){return o(this,void 0,void 0,function(){return f(this,function(t){switch(t.label){case 0:return[4,this.ready()];case 1:return t.sent(),this.options.unlockOnAccess?[4,this._unlock()]:[3,3];case 2:t.sent(),t.label=3;case 3:return[2,this.session]}})})},s.prototype._restoreSession=function(){return o(this,void 0,void 0,function(){var e;return f(this,function(t){switch(t.label){case 0:return[4,this.vault.isInUse()];case 1:return t.sent()?this.options.unlockOnAccess?[4,this._unlock()]:[3,3]:[2];case 2:t.sent(),t.label=3;case 3:return[4,(e=this).vault.getValue("session")];case 4:return e.session=t.sent(),this.onSessionRestored(this.session),[2,this.session]}})})},s.prototype.restoreSession=function(){return o(this,void 0,void 0,function(){return f(this,function(t){switch(t.label){case 0:return[4,this.ready()];case 1:return t.sent(),[2,this._restoreSession()]}})})},s.prototype.saveSession=function(n){return o(this,void 0,void 0,function(){var e;return f(this,function(t){switch(t.label){case 0:return[4,this.ready()];case 1:return t.sent(),this.config.isPasscodeSetupNeeded?[4,this.setPasscode()]:[3,3];case 2:t.sent(),t.label=3;case 3:return t.trys.push([3,5,,9]),[4,this.vault.storeValue("session",n)];case 4:return t.sent(),[3,9];case 5:return(e=t.sent()).code!==r.VaultErrorCodes.SecurityNotAvailable?[3,8]:[4,this.getAuthMode()];case 6:return t.sent()!==r.AuthMode.BiometricAndPasscode?[3,8]:[4,this.setAuthMode(r.AuthMode.PasscodeOnly)];case 7:return t.sent(),[2,this.saveSession(n)];case 8:throw e;case 9:return this.session=n,[2]}})})},s.prototype.login=function(e,n){return o(this,void 0,void 0,function(){return f(this,function(t){switch(t.label){case 0:return[4,this.ready()];case 1:return t.sent(),[4,this.logout()];case 2:return t.sent(),[4,this._trySetAuthMode(n)];case 3:return t.sent(),[2,this.saveSession(e)]}})})},s.prototype.getVault=function(){return o(this,void 0,void 0,function(){return f(this,function(t){switch(t.label){case 0:return[4,this.ready()];case 1:return t.sent(),[2,this.vault]}})})},s.prototype.initializeVault=function(){return o(this,void 0,void 0,function(){var e,n,s,r,o,i,a,u,c,d,l=this;return f(this,function(t){switch(t.label){case 0:return[4,this.platform.ready()];case 1:return t.sent(),null!=this.vault?[2,Promise.resolve()]:(null==this.vIonicNativeAuth&&(this.vIonicNativeAuth=this.getPlugin()),e=new Promise(function(t,e){l._readyResolve=t,l._readyReject=e}),n=this.options,s=n.lockAfter,r=n.hideScreenOnBackground,o=n.shouldClearVaultAfterTooManyFailedAttempts,i=n.allowSystemPinFallback,a=n.androidPromptNegativeButtonText,u=n.androidPromptTitle,c=n.androidPromptSubtitle,d=n.androidPromptDescription,this.vault=this.vIonicNativeAuth.getVault(h({lockAfter:s,hideScreenOnBackground:r,shouldClearVaultAfterTooManyFailedAttempts:o,allowSystemPinFallback:i,androidPromptNegativeButtonText:a,androidPromptTitle:u,androidPromptSubtitle:c,androidPromptDescription:d},this.descriptor,{onLock:this.onLock.bind(this),onConfig:this.onConfig.bind(this),onError:this.onError.bind(this),onUnlock:this.onUnlock.bind(this),onReady:this.onReady.bind(this)})),[2,e])}})})},s.prototype.getPlugin=function(){return IonicNativeAuth},s.prototype.getBiometricType=function(){return o(this,void 0,void 0,function(){return f(this,function(t){switch(t.label){case 0:return[4,this.ready()];case 1:return t.sent(),[2,this.vault.getBiometricType()]}})})},s.prototype.getAvailableHardware=function(){return o(this,void 0,void 0,function(){return f(this,function(t){switch(t.label){case 0:return[4,this.ready()];case 1:return t.sent(),[2,this.vault.getAvailableHardware()]}})})},s.prototype.lockOut=function(){return o(this,void 0,void 0,function(){return f(this,function(t){switch(t.label){case 0:return[4,this.ready()];case 1:return t.sent(),[4,this.vault.lock()];case 2:return t.sent(),this.session=void 0,[2]}})})},s.prototype.logout=function(){return o(this,void 0,void 0,function(){var e;return f(this,function(t){switch(t.label){case 0:return[4,this.ready()];case 1:return t.sent(),[4,this.vault.clear()];case 2:return t.sent(),this.session=void 0,[4,(e=this).vault.getConfig()];case 3:return e._config=t.sent(),[2]}})})},s.prototype.hasStoredSession=function(){return o(this,void 0,void 0,function(){return f(this,function(t){switch(t.label){case 0:return[4,this.ready()];case 1:return t.sent(),[2,this.vault.isInUse()]}})})},s.prototype.setBiometricsEnabled=function(e){return o(this,void 0,void 0,function(){return f(this,function(t){switch(t.label){case 0:return[4,this.ready()];case 1:return t.sent(),[2,this._setBiometricsEnabled(e)]}})})},s.prototype._setBiometricsEnabled=function(e){return o(this,void 0,void 0,function(){return f(this,function(t){return[2,this.vault.setBiometricsEnabled(e)]})})},s.prototype.setPasscodeEnabled=function(e){return o(this,void 0,void 0,function(){return f(this,function(t){switch(t.label){case 0:return[4,this.ready()];case 1:return t.sent(),[4,this._setPasscodeEnabled(e)];case 2:return t.sent(),[2]}})})},s.prototype._setPasscodeEnabled=function(n){return o(this,void 0,void 0,function(){var e;return f(this,function(t){switch(t.label){case 0:return[4,this.vault.setPasscodeEnabled(n)];case 1:return t.sent(),[4,(e=this).vault.getConfig()];case 2:return e._config=t.sent(),this.config.isPasscodeSetupNeeded?[4,this._setPasscode()]:[3,4];case 3:t.sent(),t.label=4;case 4:return[2]}})})},s.prototype.isBiometricsEnabled=function(){return o(this,void 0,void 0,function(){return f(this,function(t){switch(t.label){case 0:return[4,this.ready()];case 1:return t.sent(),[2,this.vault.isBiometricsEnabled()]}})})},s.prototype.isBiometricsAvailable=function(){return o(this,void 0,void 0,function(){return f(this,function(t){switch(t.label){case 0:return[4,this.ready()];case 1:return t.sent(),[2,this.vault.isBiometricsAvailable()]}})})},s.prototype.isBiometricsSupported=function(){return o(this,void 0,void 0,function(){return f(this,function(t){switch(t.label){case 0:return[4,this.ready()];case 1:return t.sent(),[2,this.vault.isBiometricsSupported()]}})})},s.prototype.isSecureStorageModeEnabled=function(){return o(this,void 0,void 0,function(){return f(this,function(t){switch(t.label){case 0:return[4,this.ready()];case 1:return t.sent(),[2,this.vault.isSecureStorageModeEnabled()]}})})},s.prototype.isPasscodeEnabled=function(){return o(this,void 0,void 0,function(){return f(this,function(t){switch(t.label){case 0:return[4,this.ready()];case 1:return t.sent(),[2,this.vault.isPasscodeEnabled()]}})})},s.prototype._setAuthMode=function(e){return o(this,void 0,void 0,function(){return f(this,function(t){switch(t.label){case 0:if((e=void 0!==e?e:this.config.authMode)===this.config.authMode)return[2];switch(e){case r.AuthMode.BiometricOnly:return[3,1];case r.AuthMode.PasscodeOnly:return[3,4];case r.AuthMode.BiometricAndPasscode:return[3,7];case r.AuthMode.BiometricOrPasscode:return[3,10];case r.AuthMode.InMemoryOnly:return[3,16];case r.AuthMode.SecureStorage:return[3,20]}return[3,22];case 1:return[4,this._setBiometricsEnabled(!0)];case 2:return t.sent(),[4,this._setPasscodeEnabled(!1)];case 3:return t.sent(),[3,23];case 4:return[4,this._setPasscodeEnabled(!0)];case 5:return t.sent(),[4,this._setBiometricsEnabled(!1)];case 6:return t.sent(),[3,23];case 7:return[4,this._setPasscodeEnabled(!0)];case 8:return t.sent(),[4,this._setBiometricsEnabled(!0)];case 9:return t.sent(),[3,23];case 10:return t.trys.push([10,13,,15]),[4,this._setBiometricsEnabled(!0)];case 11:return t.sent(),[4,this._setPasscodeEnabled(!1)];case 12:return t.sent(),[3,15];case 13:return t.sent(),[4,this._setPasscodeEnabled(!0)];case 14:return t.sent(),[3,15];case 15:return[3,23];case 16:return[4,this._setPasscodeEnabled(!1)];case 17:return t.sent(),[4,this._setBiometricsEnabled(!1)];case 18:return t.sent(),[4,this.vault.setSecureStorageModeEnabled(!1)];case 19:return t.sent(),[3,23];case 20:return[4,this.vault.setSecureStorageModeEnabled(!0)];case 21:return t.sent(),[3,23];case 22:throw{code:r.VaultErrorCodes.InvalidAuthMode,message:"Invalid AuthMode"};case 23:return[2]}})})},s.prototype._trySetAuthMode=function(n){return o(this,void 0,void 0,function(){var e;return f(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this._setAuthMode(n)];case 1:return t.sent(),[3,3];case 2:if((e=t.sent()).code!==r.VaultErrorCodes.BiometricsNotEnabled&&e.code!==r.VaultErrorCodes.SecurityNotAvailable)throw e;return[3,3];case 3:return[2]}})})},s.prototype.setAuthMode=function(e){return o(this,void 0,void 0,function(){return f(this,function(t){switch(t.label){case 0:return[4,this.ready()];case 1:return t.sent(),[2,this._setAuthMode(e)]}})})},s.prototype.getAuthMode=function(){return o(this,void 0,void 0,function(){var e;return f(this,function(t){switch(t.label){case 0:return[4,this.ready()];case 1:return t.sent(),[4,(e=this).vault.getConfig()];case 2:return e._config=t.sent(),[2,this.config.authMode]}})})},s);function s(t,e,n){this.platform=t,this.options=e,this.vIonicNativeAuth=null,this._readyCalled=!1,this.descriptor=n||{username:"_lastUser",vaultId:"default"},this._readyPromise=this.initializeVault()}return r.IonicIdentityVaultUser=n,r}({});
//# sourceMappingURL=ionic-enterprise-identity-vault.js.map